<!-- /family-dashboard/eads/tracker/meetings.html -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>EADS Â· Meetings</title>
<link rel="stylesheet" href="/family-dashboard/css/base.css">
<style>
  body{font-family:system-ui,Segoe UI,Inter,Roboto,Arial;margin:0;padding:18px;color:#e6eefc;background:#0b1220}
  a{color:inherit;text-decoration:none}header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:14px}
  .btn{padding:8px 10px;border:1px solid #2b325a;border-radius:10px;background:#0f1330}
  .card{background:#111832;border:1px solid #2b325a;border-radius:14px;padding:12px;margin-bottom:12px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}@media(max-width:800px){.row{grid-template-columns:1fr}}
  label{font-size:12px;color:#9db1d1}input,select{width:100%;padding:10px;border:1px solid #2b325a;border-radius:10px;background:#0f1330;color:#e6eefc}
  .muted{color:#9db1d1;font-size:12px}table{width:100%;border-collapse:collapse}th,td{padding:8px 10px;border-bottom:1px solid #2b325a;text-align:left;font-size:14px}
</style>
</head>
<body>
<header>
  <div><a class="btn" href="./index.html">&larr; EADS</a></div>
  <div id="auth"></div>
</header>

<h1>Meetings</h1>

<div class="card">
  <div class="row">
    <div><label>Requester</label><input id="m_requester"></div>
    <div><label>POC Email</label><input id="m_email" type="email"></div>
  </div>
  <div class="row" style="margin-top:10px">
    <div><label>Request Date/Time</label><input id="m_reqdt" type="datetime-local"></div>
    <div><label>Meeting Date/Time</label><input id="m_meetdt" type="datetime-local"></div>
  </div>
  <div class="row" style="margin-top:10px">
    <div><label>Topic</label><input id="m_topic"></div>
    <div><label>Location</label><input id="m_loc"></div>
  </div>
  <div class="row" style="margin-top:10px">
    <div><label>Status</label>
      <select id="m_status"><option>New</option><option>Pending</option><option>Scheduled</option><option>Completed</option><option>Cancelled</option></select>
    </div>
    <div><label>Notes</label><input id="m_notes"></div>
  </div>
  <div style="margin-top:12px">
    <button class="btn" id="m_save">Save</button>
    <button class="btn" id="m_update" disabled>Update</button>
    <button class="btn" id="m_delete" disabled>Delete</button>
    <span id="m_sel" class="muted"></span>
  </div>
</div>

<div class="card">
  <div class="row">
    <div><label>Status Filter</label>
      <select id="m_filter"><option value="">All</option><option>New</option><option>Pending</option><option>Scheduled</option><option>Completed</option><option>Cancelled</option></select>
    </div>
    <div><label>Search</label><input id="m_search" placeholder="Search requester, topic, notes"></div>
  </div>
  <div id="m_count" class="muted" style="margin:8px 0"></div>
  <table id="m_tbl">
    <thead><tr>
      <th data-k="createdAt">Created</th>
      <th data-k="requester">Requester</th>
      <th data-k="topic">Topic</th>
      <th data-k="meetingDateTime">Meeting</th>
      <th data-k="status">Status</th>
      <th data-k="location">Location</th>
    </tr></thead>
    <tbody></tbody>
  </table>
</div>

<script type="module">
  import { onAuthStateChanged, auth, signOutUser } from "/family-dashboard/js/firebase-init.js";
  import { gate,$ } from './eads.js'; gate();
  import { makeFSList } from './eads-fs.js';
  onAuthStateChanged(auth,(u)=>{
    if(!u){ location.href="/family-dashboard/main/index.html"; return; }
    const c=document.getElementById('auth'); c.innerHTML = `<span class="muted">${u.email}</span> <a class="btn" href="#" id="signout">Sign out</a>`;
    document.getElementById('signout').onclick=(e)=>{e.preventDefault();signOutUser();};
  });

  makeFSList({
    store:'eads_meetings',
    $thead: $('#m_tbl thead'), $tbody: $('#m_tbl tbody'),
    $save: $('#m_save'), $update: $('#m_update'), $delete: $('#m_delete'),
    $selInfo: $('#m_sel'), $search: $('#m_search'), $filter: $('#m_filter'),
    defaultSort:'meetingDateTime',
    filterFn:(r,f)=> r.status===f,
    rowHTML:r=>`<tr data-id="${r.id}">
      <td>${r.createdAt?.toDate ? r.createdAt.toDate().toLocaleString() : ''}</td>
      <td>${r.requester||''}</td><td>${r.topic||''}</td>
      <td>${r.meetingDateTime||''}</td><td>${r.status||''}</td><td>${r.location||''}</td>
    </tr>`,
    getForm:()=>({
      requester:$('#m_requester').value.trim(),
      pocEmail:$('#m_email').value.trim(),
      requestDateTime:$('#m_reqdt').value,
      meetingDateTime:$('#m_meetdt').value,
      topic:$('#m_topic').value.trim(),
      location:$('#m_loc').value.trim(),
      status:$('#m_status').value,
      notes:$('#m_notes').value.trim()
    }),
    setForm:r=>{ $('#m_requester').value=r.requester||''; $('#m_email').value=r.pocEmail||''; $('#m_reqdt').value=r.requestDateTime||''; $('#m_meetdt').value=r.meetingDateTime||''; $('#m_topic').value=r.topic||''; $('#m_loc').value=r.location||''; $('#m_status').value=r.status||'New'; $('#m_notes').value=r.notes||''; },
    clearForm:()=>{ ['#m_requester','#m_email','#m_reqdt','#m_meetdt','#m_topic','#m_loc','#m_notes'].forEach(s=>$(s).value=''); $('#m_status').value='New'; $('#m_update').disabled=$('#m_delete').disabled=true; $('#m_sel').textContent=''; }
  });
</script>
</body>
</html>
