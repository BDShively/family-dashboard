<!-- /eads/tracker/duties.html -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>EADS Â· Duties</title>
<style>body{font-family:system-ui,Segoe UI,Inter,Roboto,Arial;margin:0;padding:18px;color:#e6eefc;background:#0b1220}a{color:inherit;text-decoration:none}header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:14px}.btn{padding:8px 10px;border:1px solid #2b325a;border-radius:10px;background:#0f1330}.card{background:#111832;border:1px solid #2b325a;border-radius:14px;padding:12px;margin-bottom:12px}.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}@media(max-width:800px){.row{grid-template-columns:1fr}}label{font-size:12px;color:#9db1d1}input,select{width:100%;padding:10px;border:1px solid #2b325a;border-radius:10px;background:#0f1330;color:#e6eefc}.muted{color:#9db1d1;font-size:12px}table{width:100%;border-collapse:collapse}th,td{padding:8px 10px;border-bottom:1px solid #2b325a;text-align:left;font-size:14px}</style>
</head>
<body>
<header>
  <div><a class="btn" href="./index.html">&larr; EADS</a></div>
  <div id="auth"></div>
</header>

<h1>Duties</h1>

<div class="card">
  <div class="row">
    <div><label>Duty</label><input id="du_name"></div>
    <div><label>Owner</label><input id="du_owner"></div>
  </div>
  <div class="row" style="margin-top:10px">
    <div><label>Type</label><select id="du_type"><option>Primary</option><option>Additional</option></select></div>
    <div><label>Status</label><select id="du_status"><option>Open</option><option>In Progress</option><option>Complete</option></select></div>
  </div>
  <div class="row" style="margin-top:10px">
    <div><label>Due</label><input id="du_due" type="date"></div>
    <div><label>Notes</label><input id="du_notes"></div>
  </div>
  <div style="margin-top:12px">
    <button class="btn" id="du_save">Save</button>
    <button class="btn" id="du_update" disabled>Update</button>
    <button class="btn" id="du_delete" disabled>Delete</button>
    <span id="du_sel" class="muted"></span>
  </div>
</div>

<div class="card">
  <div class="row">
    <div><label>Type Filter</label><select id="du_filterT"><option value="">All</option><option>Primary</option><option>Additional</option></select></div>
    <div><label>Status Filter</label><select id="du_filterS"><option value="">All</option><option>Open</option><option>In Progress</option><option>Complete</option></select></div>
  </div>
  <div id="du_count" class="muted" style="margin:8px 0"></div>
  <table id="du_tbl">
    <thead><tr>
      <th data-k="createdAt">Created</th>
      <th data-k="type">Type</th>
      <th data-k="name">Duty</th>
      <th data-k="owner">Owner</th>
      <th data-k="status">Status</th>
      <th data-k="due">Due</th>
    </tr></thead>
    <tbody></tbody>
  </table>
</div>

<script type="module">
  import { gate, $ } from './eads.js'; gate();
  import { makeFSList } from './eads-fs.js';

  // combined filter value trick
  const comboFilter = {
    get value(){ return ($('#du_filterT').value||'') + '|' + ($('#du_filterS').value||''); },
    set oninput(fn){ ['#du_filterT','#du_filterS'].forEach(sel=>document.querySelector(sel).addEventListener('input',fn)); }
  };

  makeFSList({
    store:'eads_duties',
    $thead: $('#du_tbl thead'), $tbody: $('#du_tbl tbody'),
    $save: $('#du_save'), $update: $('#du_update'), $delete: $('#du_delete'),
    $selInfo: $('#du_sel'), $filter: comboFilter,
    defaultSort:'due',
    filterFn:(r,v)=>{ const [t,s]=v.split('|'); return (!t||r.type===t) && (!s||r.status===s); },
    rowHTML:r=>`<tr data-id="${r.id}">
      <td>${r.createdAt?.toDate ? r.createdAt.toDate().toLocaleString() : ''}</td>
      <td>${r.type||''}</td><td>${r.name||''}</td><td>${r.owner||''}</td><td>${r.status||''}</td><td>${r.due||''}</td>
    </tr>`,
    getForm:()=>({ type:$('#du_type').value, name:$('#du_name').value.trim(), owner:$('#du_owner').value.trim(), status:$('#du_status').value, due:$('#du_due').value, notes:$('#du_notes').value.trim() }),
    setForm:r=>{ $('#du_type').value=r.type||'Primary'; $('#du_name').value=r.name||''; $('#du_owner').value=r.owner||''; $('#du_status').value=r.status||'Open'; $('#du_due').value=r.due||''; $('#du_notes').value=r.notes||''; },
    clearForm:()=>{ ['#du_name','#du_owner','#du_due','#du_notes'].forEach(s=>$(s).value=''); $('#du_type').value='Primary'; $('#du_status').value='Open'; $('#du_update').disabled=$('#du_delete').disabled=true; $('#du_sel').textContent=''; }
  });
</script>
</body>
</html>
