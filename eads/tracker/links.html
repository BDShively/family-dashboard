<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Force Quick Links</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f2f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .dark-mode {
            background-color: #212529;
            color: #f8f9fa;
        }
        .dark-mode .card, .dark-mode .accordion-button {
            background-color: #343a40;
            color: #f8f9fa;
            border-color: #495057;
        }
        .dark-mode .btn-link { color: #f8f9fa; }
        .card {
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
        }
        .btn-custom {
            background-color: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 10px 20px;
            margin: 5px;
            color: #2c3e50;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
            display: inline-block;
        }
        .btn-custom:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            background-color: #e9ecef;
        }
        .search-bar { max-width: 500px; margin: 20px auto; }
        .accordion-button { font-weight: 600; color: #2c3e50; }
        .add-form {
            background: #e7f3ff; padding: 20px; border-radius: 10px;
            margin: 20px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .add-form input, .add-form select, .add-form button {
            margin: 8px 0; padding: 10px; font-size: 16px; border-radius: 6px;
        }
        .add-form button {
            background: #0066cc; color: white; border: none; cursor: pointer;
        }
        .add-form button:hover { background: #0055aa; }
        .save-status { font-size: 0.9em; color: #28a745; font-weight: bold; }
        .raw-data { display: none; }
    </style>
</head>
<body>
    <div class="container my-4">
        <h1 class="text-center mb-4">Air Force Quick Links</h1>

        <!-- Controls -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <button id="darkModeToggle" class="btn btn-outline-secondary">Dark Mode</button>
            <button id="addBookmarkBtn" class="btn btn-success">Add New Link</button>
        </div>

        <!-- Search Bar -->
        <div class="search-bar">
            <input type="text" id="searchInput" class="form-control" placeholder="Search links..." aria-label="Search links">
        </div>

        <!-- Add New Link Form -->
        <div id="addForm" class="add-form" style="display: none;">
            <h4>Add New Bookmark</h4>
            <input type="text" id="newTitle" class="form-control" placeholder="Link Title (e.g. DTS)">
            <input type="url" id="newUrl" class="form-control" placeholder="https://example.com">
            <select id="newCategory" class="form-control">
                <option value="">Select or type new category...</option>
            </select>
            <input type="text" id="newCategoryInput" class="form-control" placeholder="Or type a new category" style="display:none;">
            <div class="mt-2">
                <button id="saveBookmark" class="btn btn-primary">Save to File</button>
                <button id="cancelAdd" class="btn btn-secondary">Cancel</button>
            </div>
            <div id="saveStatus" class="save-status mt-2"></div>
        </div>

        <!-- Accordion for Links -->
        <div id="accordionLinks" class="accordion"></div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- RAW TEXT DATA (Human-Readable in Editor) -->
    <pre id="rawData" class="raw-data">

# Personal
NIPRGPT | https://www.chat.niprgpt.mil/
Gmail | https://www.gmail.com/
USAA | https://www.usaa.com/
NFCU | https://www.nfcu.org/
National Grid | https://www.nationalgrid.com/
Spectrum | https://www.spectrum.net/
Propane | https://www.superiorpluspropane.com/
Ally | https://www.allyauto.com/
TravisCU | https://www.traviscu.org/
EmpowerFCU | https://www.empowerfcu.com/
TSP | https://www.tsp.gov/
LeaveWeb | https://www.leave.af.mil/
Facebook | https://www.facebook.com/

# Finances
MyPay | https://www.mypay.dfas.mil/
Smart Traveller Enrollment Program | https://step.state.gov/STEP/pages/individuals/emailtravelinfo.aspx
Citi Commercial Card | https://home.cards.citidirect.com/CommercialCard/login
DTS | https://dtsproweb.defensetravel.osd.mil/dts-app/pubsite/all/view
DTS Guidance | https://usaf.dps.mil/sites/34151/224ADS/OSF/SitePages/Home.aspx

# CSS

# Training
ETCA (Formal Schools) | https://usaf.dps.mil/teams/app10-etca/sitepages/home.aspx
myLearning | https://lms-jets.cce.af.mil/moodle/
myTraining | https://sso.josce.mil/auth/realms/sso/protocol/openid-connect/auth?client_id=tftr_production&redirect_uri=https%3A%2F%2Ftftr.josce.mil%2F%23%2F&state=71661d7c-ebce-49c2-8905-deca8e02872e&response_mode=fragment&response_type=code&scope=openid&nonce=fa856caa-62e3-423c-88d9-f0fabd2395e6
AFVEC | https://afvec.us.af.mil/afvec/public/welcome
Joint Knowledge Online (JKO) | https://jkodirect.jten.mil/Atlas2/page/login/Login.jsf
Equipment Custodian Training | https://usaf.dps.mil/teams/ccc/itam/SitePages/Home.aspx
FedVTE | https://fedvte.usalearning.gov/
MyFSS Training Library | https://afbpap.my.salesforce.mil/sfc/p/#t0000000LB5w/a/t00000008OJ8/tjqyW.eQC5yJ1B412NSJxeCWohnMv9qo8wd1p7rA1yU

# Medical
myIMR | https://asimsimr.health.mil/imr/myIMR.aspx
MHS Genesis Patient Portal | https://patientportal.mhsgenesis.health.mil/

# Executive Officer
AF Acronyms | https://www.afpc.af.mil/Career-Management/Acronyms/
IGEMS | https://igems.cce.af.mil/igems/home.do?r=5153317650372121398
MICT | https://mict.cce.af.mil
ETIMS | https://etims.cce.af.mil/ETIMS/index

# GPC AO
PIEE / US Bank | https://piee.eb.mil/xhtml/unauth/home/login.xhtml
Thomas Register (GPC Suppliers) | https://www.thomasnet.com/suppliers/
GSA Advantage (GPC Suppliers) | https://www.gsaadvantage.gov
IBVI | https://www.ibvisupply.com/
AFWAY | https://www.afway.af.mil/login.aspx
DAU Login | https://id.dau.edu/
Mastercard IOD | https://iodgov.oversightsystems.us
GPC Excel Files | P:\SPTS\SCXR\GPC\
Form 14 for processing | P:\SPTS\SCXR\GPC\Wing 14s\FY23 Form-14's
AFWAY Purchasing | https://www.afway.af.mil/Default.aspx
GPC FY24 PRAFs | P:\SPTS\SCXR\GPC\FY24

# PowerBI
OneDrive Lists | https://usaf-my.dps.mil/personal/beau_shively_2_us_af_mil/_layouts/15/Lists.aspx
SRR Inspection | https://usaf-my.dps.mil/personal/patrick_young_10_us_af_mil/_layouts/15/listforms.aspx?cid=Y2NhMzg1NTUtNGQyNy00YmE1LTgxNGUtZGFkZWFkMDc5ZWUw&nav=YzRhMGM0MzQtOWQ4Yy00NzRhLTkwYTUtNjgwMjEwYmNiNzg0
SRR Checklist | https://usaf-my.dps.mil/personal/patrick_young_10_us_af_mil/Lists/Standard%20Readiness%20Review%20Checklist/AllItems.aspx?env=WebViewList
SRR Roster | https://usaf-my.dps.mil/personal/patrick_young_10_us_af_mil/Lists/Female%20Officer%20and%20Enlisted%20Uniforms/AllItems.aspx?env=WebViewList

# SPTS Resources
Key Staff Calendar | https://usaf.dps.mil/sites/34151/224SPTS/Lists/Key%20Staff%20Calendar/calendar.aspx

# EADS Resources
EADS Sharepoint | https://usaf.dps.mil/sites/34151/sitepages/home.aspx
BCC Conf Room | https://usaf.dps.mil/sites/34151/Lists/BCC%20Conf%20Room/calendar.aspx
EADS Priority Matrix | https://usaf.dps.mil/teams/224thADGAll/Shared%20Documents/Forms/AllItems.aspx?csf=1&web=1&e=ISctLQ&cid=6702f92a%2D70d8%2D43f3%2Dbb0f%2Daffd6ae76690&RootFolder=%2Fteams%2F224thADGAll%2FShared%20Documents%2FGeneral%2FCommunications%20Focal%20Point%20Priority%20Matrix&FolderCTID=0x0120004C404037CA92FC4F96CD57E9FA933F70
EADS Strategic Calendar | https://usaf.dps.mil/sites/34151/224ADS/EADSStrategicCalendar/Shared Documents/EADSStratCal.aspx

# USAF & NGB Resources
AF Portal | https://www.my.af.mil
PRDA | https://af.okta.mil
AF Personnel Accountability and Assessment System (AFPAAS) | https://afpaas.af.mil/
DMDC MilConnect | https://milconnect.dmdc.osd.mil/milconnect/
SharePoint | https://usaf.dps.mil/_layouts/15/sharepoint.aspx?
OWA+ Email | https://webmail.apps.mil/mail/inbox
MS Teams | https://dod.teams.microsoft.us/
Enterprise Service Desk Portal | https://esd.us.af.mil/ESDPortal/default.aspx
ePubs | https://www.e-publishing.af.mil/

# Local Drive Links
UMD | P:\ADG\Command Staff\(PA) Leadership Info
GPC Files | P:\SPTS\SCXR\GPC
SEL Continuity | P:\SPTS\CC\CC-Key Staff\SEL Continuity
OPM Telework Training | https://www.opm.gov/telework/
OPM Manager Telework Training | https://www.opm.gov/telework/training/manager-telework-fundamentals/index.htm
EADS EMSEC Status | https://usaf.dps.mil/:x:/r/sites/34151/224SPTS/SCX/SCXS/_layouts/15/doc2.aspx?sourcedoc=%7Bddd74113-d3a9-41b3-88d1-2089acd79faf%7D&action=view&wdSource=https%3A%2F%2Fusaf.dps.mil%2Fsites%2F34151%2F224SPTS%2FSCX%2FSCXS%2FSitePages%2FEMSEC%20Package%20Status.aspx&wdEWRClick=true&Source=https%3A%2F%2Fusaf.dps.mil%2Fsites%2F34151%2F224SPTS%2FSCX%2FSCXS%2FSitePages%2FEMSEC%20Package%20Status.aspx
    </pre>

    <script>
        let fileHandle = null;
        let linkData = [];

        // === MAIN INIT ===
        document.addEventListener('DOMContentLoaded', async () => {
            // Parse data
            const rawText = document.getElementById('rawData').textContent.trim();
            parseRawData(rawText);
            renderAccordion();
            populateCategories();

            // Request file access
            await requestFileAccess();

            // Setup UI
            setupEvents();
        });

        // === REQUEST FILE ACCESS ===
        async function requestFileAccess() {
            if ('showOpenFilePicker' in window) {
                try {
                    [fileHandle] = await window.showOpenFilePicker({
                        types: [{ description: 'HTML Files', accept: { 'text/html': ['.html'] }}],
                        multiple: false
                    });
                    console.log("File access granted:", fileHandle.name);
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        alert("File access denied. Save will not work. Open in Chrome/Edge and allow access.");
                    }
                }
            } else {
                alert("Your browser does not support file saving.");
            }
        }

        // === PARSE RAW DATA ===
        function parseRawData(text) {
            const lines = text.split('\n').map(l => l.trim()).filter(l => l);
            let current = null;
            linkData = [];

            lines.forEach(line => {
                if (line.startsWith('# ')) {
                    const cat = line.slice(2).trim();
                    if (cat) {
                        current = { 
                            category: cat, 
                            id: cat.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/-+$/, '') || 'cat',
                            links: [] 
                        };
                        linkData.push(current);
                    }
                } else if (line.includes('|') && current) {
                    const [name, url] = line.split('|').map(s => s.trim());
                    if (name && url) current.links.push({ name, url });
                }
            });
        }

        // === RENDER ACCORDION ===
        function renderAccordion() {
            const container = document.getElementById('accordionLinks');
            container.innerHTML = '';
            linkData.forEach(cat => {
                const item = document.createElement('div');
                item.className = 'accordion-item';
                item.innerHTML = `
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapse-${cat.id}">${cat.category} <small class="text-muted">(${cat.links.length})</small></button>
                    </h2>
                    <div id="collapse-${cat.id}" class="accordion-collapse collapse" data-bs-parent="#accordionLinks">
                        <div class="accordion-body">
                            <div class="d-flex flex-wrap justify-content-center" id="links-${cat.id}"></div>
                        </div>
                    </div>
                `;
                container.appendChild(item);
                const linksDiv = item.querySelector(`#links-${cat.id}`);
                cat.links.forEach(l => {
                    const a = document.createElement('a');
                    a.href = l.url; 
                    a.target = '_blank'; 
                    a.className = 'btn btn-custom';
                    a.textContent = l.name;
                    linksDiv.appendChild(a);
                });
            });
        }

        // === POPULATE CATEGORIES ===
        function populateCategories() {
            const select = document.getElementById('newCategory');
            select.innerHTML = '<option value="">Select or type new category...</option>';
            linkData.forEach(cat => {
                const opt = new Option(cat.category, cat.category);
                select.appendChild(opt);
            });
        }

        // === SETUP EVENTS ===
        function setupEvents() {
            document.getElementById('darkModeToggle').onclick = () => document.body.classList.toggle('dark-mode');
            document.getElementById('addBookmarkBtn').onclick = () => {
                document.getElementById('addForm').style.display = 'block';
                document.getElementById('newTitle').focus();
            };
            document.getElementById('cancelAdd').onclick = () => {
                document.getElementById('addForm').style.display = 'none';
                clearForm();
            };
            document.getElementById('newCategory').onchange = function() {
                document.getElementById('newCategoryInput').style.display = this.value ? 'none' : 'block';
            };
            document.getElementById('saveBookmark').onclick = saveBookmark;
            document.getElementById('searchInput').oninput = searchLinks;
        }

        // === CLEAR FORM ===
        function clearForm() {
            ['newTitle','newUrl','newCategory','newCategoryInput'].forEach(id => document.getElementById(id).value = '');
            document.getElementById('newCategoryInput').style.display = 'none';
        }

        // === SAVE BOOKMARK ===
        async function saveBookmark() {
            const title = document.getElementById('newTitle').value.trim();
            const url = document.getElementById('newUrl').value.trim();
            let category = document.getElementById('newCategory').value || document.getElementById('newCategoryInput').value.trim();
            if (!category) category = "Uncategorized";

            if (!title || !url) return alert("Please fill in Title and URL");
            if (!url.match(/^https?:\/\//i)) return alert("URL must start with http:// or https://");

            // Add to data
            let catObj = linkData.find(c => c.category === category);
            if (!catObj) {
                const id = category.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/-+$/, '') || 'cat';
                catObj = { category, id, links: [] };
                linkData.push(catObj);
            }
            catObj.links.push({ name: title, url });

            // Save to file
            if (fileHandle) {
                try {
                    const writable = await fileHandle.createWritable();
                    const newHtml = generateUpdatedHtml();
                    await writable.write(newHtml);
                    await writable.close();

                    document.getElementById('saveStatus').textContent = "Saved to file!";
                    setTimeout(() => document.getElementById('saveStatus').textContent = '', 3000);
                } catch (e) {
                    console.error("Save error:", e);
                    alert("Save failed: " + e.message);
                }
            } else {
                alert("No file access. Open the file and allow access to save.");
            }

            // Update UI
            renderAccordion();
            populateCategories();
            clearForm();
            document.getElementById('addForm').style.display = 'none';
        }

        // === GENERATE UPDATED HTML ===
        function generateUpdatedHtml() {
            let raw = '';
            linkData.forEach(cat => {
                raw += `# ${cat.category}\n`;
                cat.links.forEach(l => raw += `${l.name} | ${l.url}\n`);
                raw += '\n';
            });

            const pre = document.getElementById('rawData');
            const indent = pre.outerHTML.match(/^\s*/)[0];
            const lines = raw.trim().split('\n');
            const indentedLines = lines.map(line => indent + '    ' + line);
            const newPreContent = indentedLines.join('\n');

            return document.documentElement.outerHTML.replace(
                /<pre id="rawData"[\s\S]*?<\/pre>/,
                `<pre id="rawData" class="raw-data">\n${newPreContent}\n${indent}    </pre>`
            );
        }

        // === SEARCH ===
        function searchLinks() {
            const query = this.value.toLowerCase();
            document.querySelectorAll('.btn-custom').forEach(btn => {
                btn.style.display = btn.textContent.toLowerCase().includes(query) ? 'inline-block' : 'none';
            });
            document.querySelectorAll('.accordion-item').forEach(item => {
                const visible = item.querySelectorAll('.btn-custom[style*="inline-block"]').length > 0;
                item.style.display = visible ? 'block' : 'none';
            });
        }
    </script>
</body>
</html>
