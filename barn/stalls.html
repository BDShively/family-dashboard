<!-- /family-dashboard/barn/stalls.html -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Barn · Stalls</title>
<link rel="stylesheet" href="/family-dashboard/css/base.css">
<style>
:root{--bg:#0b1220;--bg2:#0f1a2b;--fg:#e6eefc;--muted:#9db1d1;--card:#111832;--line:#2b325a;
      --occ:rgba(46,134,222,.55);--sch:rgba(246,196,76,.50);--emp:rgba(230,57,70,.45)}
*{box-sizing:border-box}body{margin:0;font-family:system-ui,Inter;background:linear-gradient(160deg,var(--bg),var(--bg2));color:var(--fg)}
a{color:inherit;text-decoration:none}.wrap{max-width:1100px;margin:auto;padding:18px}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.btn{padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:#0f1330}
.muted{color:var(--muted);font-size:12px}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-bottom:12px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}@media(max-width:860px){.row{grid-template-columns:1fr}}
label{font-size:12px;color:var(--muted)}
input,textarea{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;background:#0f1330;color:var(--fg)}
.map-wrap{position:relative;max-width:100%;border:1px solid var(--line);border-radius:12px;overflow:hidden;background:#0e132a}
.map-wrap img{display:block;width:100%;height:auto}
.stall-btn{position:absolute;border:2px solid rgba(255,255,255,.6);border-radius:6px;background:transparent;cursor:pointer;padding:0}
.stall-btn .num{opacity:0}
.legend{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.badge{border:1px solid var(--line);border-radius:999px;padding:4px 8px;font-size:12px}
.filters{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.filters .btn[aria-pressed="true"]{outline:2px solid #2b6cb0}
table{width:100%;border-collapse:collapse}th,td{padding:8px 10px;border-bottom:1px solid var(--line);text-align:left;font-size:14px}
th{color:var(--muted)}.actions{display:flex;gap:6px;flex-wrap:wrap}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div><a class="btn" href="/family-dashboard/barn/index.html">Barn</a> <a class="btn" href="/family-dashboard/index.html">Home</a></div>
    <div id="auth"></div>
  </header>

  <h1>Stalls</h1>

  <div class="card">
    <div class="row">
      <div><label>As of date</label><input id="asOfDate" type="date"/></div>
      <div>
        <label>Map filter</label>
        <div class="filters">
          <button class="btn" data-filter="all" aria-pressed="true">All</button>
          <button class="btn" data-filter="occupied">Occupied</button>
          <button class="btn" data-filter="scheduled">Scheduled</button>
          <button class="btn" data-filter="empty">Empty</button>
          <span class="legend">
            <span class="badge" style="background:var(--occ)">Occupied</span>
            <span class="badge" style="background:var(--sch)">Scheduled</span>
            <span class="badge" style="background:var(--emp)">Empty</span>
          </span>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="map-wrap">
      <img id="barnImg" src="/family-dashboard/assets/barn_layout.jpg" alt="Barn layout">
      <div id="overlay"></div>
    </div>
    <div class="muted" style="margin-top:6px">Click a stall to view its history. Use “Clear selection” to return.</div>
  </div>

  <div class="card">
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px">
      <h2 id="listTitle" style="margin:0;font-size:18px">Occupancy</h2>
      <div class="muted" id="listSub"></div>
      <span style="flex:1"></span>
      <button class="btn" id="clearSel" style="display:none">Clear selection</button>
    </div>
    <table id="occTbl">
      <thead><tr>
        <th>Stall</th><th>Horse</th><th>Owner</th><th>Arrival</th><th>Departure</th><th>Income $/mo</th><th>Program</th><th>Notes</th><th>Actions</th>
      </tr></thead><tbody></tbody>
    </table>
  </div>

  <div class="card">
    <h3 style="margin:6px 0 10px">Add / Edit Occupancy</h3>
    <div class="row">
      <div><label>Stall #</label><input id="f_stall" type="number" min="1" max="18"></div>
      <div><label>Horse</label><input id="f_horse"></div>
    </div>
    <div class="row" style="margin-top:10px">
      <div><label>Owner</label><input id="f_owner"></div>
      <div><label>Income $/month</label><input id="f_income" type="number" step="0.01"></div>
    </div>
    <div class="row" style="margin-top:10px">
      <div><label>Arrival</label><input id="f_arrive" type="date"></div>
      <div><label>Departure</label><input id="f_depart" type="date" placeholder="blank = open"></div>
    </div>
    <div style="margin-top:10px"><label>Training / Notes</label><textarea id="f_notes"></textarea></div>
    <div class="actions" style="margin-top:12px">
      <button class="btn" id="saveRec">Save</button>
      <button class="btn" id="updateRec" disabled>Update</button>
      <button class="btn" id="deleteRec" disabled>Delete</button>
      <span class="muted" id="editInfo"></span>
    </div>
  </div>
</div>

<script type="module">
  import { onAuthStateChanged, auth, signOutUser } from "/family-dashboard/js/firebase-init.js";
  const LOGIN="/family-dashboard/main/index.html";
  onAuthStateChanged(auth,(u)=>{
    if(!u){ location.href=LOGIN; return; }
    const c=document.getElementById('auth');
    c.innerHTML = `<span class="muted">${u.email}</span> <a class="btn" href="#" id="signout">Sign out</a>`;
    signout.onclick=(e)=>{e.preventDefault();signOutUser();};
  });
</script>
<script type="module" src="/family-dashboard/barn/barn-stalls.js"></script>
</body>
</html>
