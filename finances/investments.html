<!-- /family-dashboard/finances/investments.html -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Finances · Investments</title>
<link rel="stylesheet" href="/family-dashboard/css/base.css">
<style>
:root{--card:#111832;--muted:#9db1d1;--fg:#e6eefc;--line:#2b325a}
body{margin:0;font-family:system-ui,Inter;background:#0b1220;color:var(--fg);padding:18px}
a{color:inherit;text-decoration:none}header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.btn{padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:#0f1330}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-bottom:12px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}@media(max-width:800px){.row{grid-template-columns:1fr}}
label{font-size:12px;color:var(--muted)}input,select{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;background:#0f1330;color:#e6eefc}
.muted{color:var(--muted);font-size:12px}table{width:100%;border-collapse:collapse}th,td{padding:8px 10px;border-bottom:1px solid var(--line);text-align:left;font-size:14px}
th{color:var(--muted)}
</style>
</head>
<body>
<header>
  <div><a class="btn" href="./index.html">&larr; Finances</a></div>
  <div id="auth"></div>
</header>

<h1>Investments</h1>

<div class="card">
  <div class="row">
    <div><label>Date</label><input id="f_date" type="date"></div>
    <div><label>Account</label><select id="f_acct"><option>TSP</option><option>Other</option></select></div>
  </div>
  <div class="row" style="margin-top:10px">
    <div><label>Contribution ($)</label><input id="f_contrib" type="number" step="0.01"></div>
    <div><label>Balance ($)</label><input id="f_balance" type="number" step="0.01"></div>
  </div>
  <div style="margin-top:12px">
    <button class="btn" id="save">Save</button>
    <button class="btn" id="update" disabled>Update</button>
    <button class="btn" id="remove" disabled>Delete</button>
    <span id="sel" class="muted"></span>
  </div>
</div>

<div class="card">
  <div class="row">
    <div><label>Account Filter</label><select id="filter"><option value="">All</option><option>TSP</option><option>Other</option></select></div>
    <div><label>Search</label><input id="search" placeholder="—"></div>
  </div>
  <div id="count" class="muted" style="margin:8px 0"></div>
  <table id="tbl">
    <thead><tr>
      <th data-k="date">Date</th><th data-k="account">Account</th><th data-k="contribution">Contribution</th><th data-k="balance">Balance</th>
    </tr></thead><tbody></tbody>
  </table>
</div>

<script type="module">
  import { onAuthStateChanged, auth, signOutUser } from "/family-dashboard/js/firebase-init.js";
  import { makeFSList, $ } from './fin.js';
  const LOGIN="/family-dashboard/main/index.html";
  onAuthStateChanged(auth,(u)=>{ if(!u){ location.href=LOGIN; return; } const c=document.getElementById('auth'); c.innerHTML=`<span class="muted">${u.email}</span> <a class="btn" href="#" id="signout">Sign out</a>`; signout.onclick=(e)=>{e.preventDefault();signOutUser();}; });

  makeFSList({
    store:'finances_investments',
    $thead: $('#tbl thead'), $tbody: $('#tbl tbody'),
    $save: $('#save'), $update: $('#update'), $delete: $('#remove'),
    $selInfo: $('#sel'), $search: $('#search'), $filter: $('#filter'),
    defaultSort:'date',
    filterFn:(r,f)=> r.account===f,
    rowHTML:r=>`<tr data-id="${r.id}"><td>${r.date||''}</td><td>${r.account||''}</td><td>${fmt(r.contribution)}</td><td>${fmt(r.balance)}</td></tr>`,
    getForm:()=>({ date:$('#f_date').value, account:$('#f_acct').value, contribution:num($('#f_contrib').value), balance:num($('#f_balance').value) }),
    setForm:r=>{ $('#f_date').value=r.date||''; $('#f_acct').value=r.account||'TSP'; $('#f_contrib').value=r.contribution??''; $('#f_balance').value=r.balance??''; },
    clearForm:()=>{ ['#f_date','#f_contrib','#f_balance'].forEach(s=>$(s).value=''); $('#f_acct').value='TSP'; }
  });

  function num(v){ return v? Number(v): null } function fmt(v){ return v==null?'': Number(v).toFixed(2) }
</script>
</body>
</html>
